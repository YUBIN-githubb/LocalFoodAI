<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆœì²œ ë°¥ìƒ</title>
    <link rel="icon" type="image/png" href="image_favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Gowun+Dodum&family=IBM+Plex+Sans+KR&family=Jua&family=Nanum+Pen+Script&display=swap');
        body {
            font-family: 'Jua', sans-serif;
            background-image: url('/image_ai.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .chat-container {
            max-width: 700px;
            height: 90vh;
        }
        .chat-box {
            height: calc(100% - 100px);
            overflow-y: auto;
        }
        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
            margin-bottom: 12px;
            word-wrap: break-word;
            line-height: 1.5;
        }
        .user-message {
            background-color: #8c7657;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #e5e5e0;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .button-group button {
            transition: all 0.2s;
        }
        .button-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .item-list button {
            background-color: #A1C935;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 8px;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-[#F7F7F0] flex items-center justify-center p-4">

    <div class="chat-container w-full bg-white rounded-3xl shadow-xl flex flex-col p-6">
        
        <!-- Header -->
        <div class="header text-center pb-4 border-b border-gray-200 mb-6">
            <div class="flex items-center justify-center gap-3">
                <img src="image_favicon.png" alt="ìˆœì²œ ë¡œì»¬í‘¸ë“œ ì•„ì´ì½˜" class="w-10 h-10">
                <h1 class="text-3xl font-bold text-[#3B482A]">ìˆœì²œ ë°¥ìƒ</h1>
            </div>
            <p class="text-gray-500 mt-2">AI ìˆœì²œ ë¡œì»¬í‘¸ë“œ ë ˆì‹œí”¼ë¡œ í•œ ë¼ ì‹ì‚¬ë¥¼ ëšë”± ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
        </div>

        <!-- Chat Box -->
        <div id="chat-box" class="chat-box flex flex-col flex-grow">
            <!-- ì±—ë´‡ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- User Input & Buttons -->
        <div class="input-area mt-4 pt-4 border-t border-gray-200">
            <div class="button-group flex justify-center space-x-2 mb-4">
                <button onclick="handleInitialPrompt('seasonal')" class="py-3 px-6 bg-[#A1C935] text-white font-semibold rounded-full shadow-lg hover:bg-[#8bb42c]">ì œì²  ë ˆì‹œí”¼</button>
                <button onclick="showCustomInput()" class="py-3 px-6 bg-[#3B482A] text-white font-semibold rounded-full shadow-lg hover:bg-[#2e3721]">ë§ì¶¤í˜• ë ˆì‹œí”¼</button>
            </div>
            
            <div id="custom-input-area" class="hidden">
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mb-4">
                    <input type="text" id="user-ingredients" placeholder="ì—¬ëŸ¬ë¶„ì˜ ëƒ‰ì¥ê³  ì† ì¬ë£Œë¥¼ ì…ë ¥í•˜ì„¸ìš”!" class="flex-grow p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A1C935]">
                    <select id="ingredient-category" class="p-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#A1C935]">
                        <option value="agricultural">ë†ì‚°ë¬¼</option>
                        <option value="fishery">ìˆ˜ì‚°ë¬¼</option>
                        <option value="livestock">ì¶•ì‚°ë¬¼</option>
                    </select>
                </div>
                <div class="flex justify-center">
                    <button onclick="handleCustomPrompt()" class="w-full py-3 bg-[#A1C935] text-white font-semibold rounded-full shadow-lg hover:bg-[#8bb42c]">ë ˆì‹œí”¼ ì¶”ì²œë°›ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AI API Key (ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”)
        const API_KEY = ""; 
        const API_URL = "https://api.openai.com/v1/chat/completions";
        
        const chatBox = document.getElementById('chat-box');
        const customInputArea = document.getElementById('custom-input-area');
        const userIngredientsInput = document.getElementById('user-ingredients');
        const ingredientCategorySelect = document.getElementById('ingredient-category');

        let data = {};
        
        // ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€
        addMessage('ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹ ìˆœì²œ ë¡œì»¬í‘¸ë“œ ë ˆì‹œí”¼ AI ì±—ë´‡, ìˆœì²œë°¥ìƒì…ë‹ˆë‹¤.\nì›í•˜ì‹œëŠ” ê¸°ëŠ¥ì„ ì„ íƒí•´ ë³´ì„¸ìš”.\n\nğŸ¥¬ ì œì²  ë ˆì‹œí”¼\nâ†’ í˜„ì¬ ìˆœì²œì˜ ì œì²  ì‹ì¬ë£Œë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê°„ë‹¨í•˜ê³  ë§›ìˆëŠ” ë ˆì‹œí”¼ ì¶”ì²œ\n\nğŸ³ ë§ì¶¤í˜• ë ˆì‹œí”¼\nâ†’ ë‚´ ëƒ‰ì¥ê³  ì† ì¬ë£Œ + ë¡œì»¬í‘¸ë“œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ë©´ í•¨ê»˜ í™œìš©í•  ìˆ˜ ìˆëŠ” ë¡œì»¬í‘¸ë“œì™€ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œ\n\nì—¬ëŸ¬ë¶„ì˜ ëƒ‰ì¥ê³  ì† ì¬ë£Œë¥¼ ì…ë ¥í•˜ê³ , ì›í•˜ëŠ” ë¡œì»¬í‘¸ë“œ ì¹´í…Œê³ ë¦¬ë¥¼ ê³¨ë¼ë³´ì„¸ìš”!\nìƒˆë¡œìš´ ìš”ë¦¬ë¥¼ ì†ì‰½ê²Œ ë§Œë‚˜ë³¼ ìˆ˜ ìˆì–´ìš”. ğŸ½ï¸', 'bot');

        // JSON ë°ì´í„° íŒŒì¼ ë¡œë“œ
        async function loadData() {
            
            const files = [
                'sclocal_products_agricultural.json', 
                'sclocal_products_fishery.json',
                'sclocal_products_livestock.json', 
                'sclocal_products_seasonal.json'
            ];
            
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (!response.ok) throw new Error(`Failed to load ${file}`);
                    data[file.replace('.json', '')] = await response.json();
                } catch (error) {
                    console.error('Error loading data file:', error);
                    addMessage(`ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`, 'bot');
                }
            }
        }
        
        // ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜í•˜ëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜
        function parseMarkdown(text) {
            return text
                // í—¤ë”© ì²˜ë¦¬ (# ## ###)
                .replace(/^### (.*$)/gim, '<h3 class="text-lg font-bold text-gray-800 mt-4 mb-2">$1</h3>')
                .replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold text-gray-800 mt-5 mb-3">$1</h2>')
                .replace(/^# (.*$)/gim, '<h1 class="text-2xl font-bold text-[#3B482A] mt-6 mb-4">$1</h1>')
                // ë³¼ë“œ ì²˜ë¦¬ (**text**)
                .replace(/\*\*(.*?)\*\*/g, '<strong class="font-bold">$1</strong>')
                // ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ (- item)
                .replace(/^- (.*$)/gim, '<li class="ml-4 mb-1 list-disc">$1</li>')
                // ìˆ«ì ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ (1. item)
                .replace(/(^\d+\. .*$)/gim, '<ol class="list-decimal ml-4">$1</ol>')
                .replace(/^\d+\. (.*$)/gim, '<li class="mb-1">$1</li>')
                // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                .replace(/\n/g, '<br>');
        }
        
        // ì±—ë´‡ ë˜ëŠ” ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message-bubble', 'p-3', 'rounded-xl', 'text-gray-800');
            
            // ë´‡ ë©”ì‹œì§€ì¸ ê²½ìš° ë§ˆí¬ë‹¤ìš´ íŒŒì‹± ì ìš©
            if (sender === 'bot') {
                messageElement.innerHTML = parseMarkdown(text);
            } else {
                messageElement.innerHTML = text.replace(/\n/g, '<br>');
            }
            
            if (sender === 'user') {
                messageElement.classList.add('bg-[#8c7657]', 'text-white', 'self-end', 'rounded-br-none');
            } else {
                messageElement.classList.add('bg-[#e5e5e0]', 'self-start', 'rounded-bl-none');
            }
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ/ìˆ¨ê¸°ê¸°
        function showLoading(show) {
            const loadingElementId = 'loading-message';
            if (show) {
                if (!document.getElementById(loadingElementId)) {
                    const loadingElement = document.createElement('div');
                    loadingElement.id = loadingElementId;
                    loadingElement.classList.add('message-bubble', 'bot-message', 'self-start', 'animate-pulse');
                    loadingElement.innerHTML = '...';
                    chatBox.appendChild(loadingElement);
                    chatBox.scrollTop = chatBox.scrollHeight;
                }
            } else {
                const loadingElement = document.getElementById(loadingElementId);
                if (loadingElement) {
                    loadingElement.remove();
                }
            }
        }

        // ì œì²  ë ˆì‹œí”¼ ì¶”ì²œ ì²˜ë¦¬ - ìƒí’ˆ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
        async function handleInitialPrompt(type) {
            addMessage("ìˆœì²œì˜ ì œì² ìƒí’ˆì…ë‹ˆë‹¤. ë ˆì‹œí”¼ë¥¼ ë³´ê³  ì‹¶ì€ ìƒí’ˆì„ ê³¨ë¼ì£¼ì„¸ìš”!", "bot");
            
            const productsList = data.sclocal_products_seasonal.map(item => item.ìƒí’ˆëª…);

            console.log(productsList)

            let listHTML = '<ul>';
            productsList.forEach(product => {
                listHTML += `
                    <li class="flex items-center justify-between mb-2 p-2 bg-white rounded-lg shadow-sm">
                        <span class="text-gray-700">${product}</span>
                        <button onclick="handleProductSelection('${product}')" class="flex-shrink-0 py-1 px-3 bg-[#A1C935] text-white rounded-full text-xs font-semibold hover:bg-[#8bb42c]">ë ˆì‹œí”¼ ë³´ê¸°</button>
                    </li>
                `;
            });
            listHTML += '</ul>';
            
            addMessage(listHTML, 'bot');
        }

        // ì‚¬ìš©ìê°€ ìƒí’ˆì„ ì„ íƒí–ˆì„ ë•Œ ë ˆì‹œí”¼ ìš”ì²­
        async function handleProductSelection(productName) {
            addMessage(`'${productName}' ë ˆì‹œí”¼ë¥¼ ë³´ì—¬ì¤˜`, "user");
            showLoading(true);
            
            const prompt = `ë‹¹ì‹ ì€ ìˆœì²œ ë¡œì»¬í‘¸ë“œì™€ ì œì²  ì‹ì¬ë£Œì— ì „ë¬¸ì„±ì„ ê°€ì§„ ì…°í”„ & í‘¸ë“œ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
                            '${productName}'ì„(ë¥¼) í™œìš©í•œ ê°„ë‹¨í•˜ê³  ë”°ë¼ í•˜ê¸° ì‰¬ìš´ ê°€ì •ì‹ ìš”ë¦¬ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”.

                            ì¶œë ¥ í˜•ì‹:

                            ë ˆì‹œí”¼ ì´ë¦„ - ëŒ€ì¤‘ì ì´ë©´ì„œ ì§ê´€ì ì¸ ì´ë¦„

                            ê°„ë‹¨í•œ ìš”ë¦¬ ì„¤ëª… - í•´ë‹¹ ìš”ë¦¬ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…

                            ì¡°ë¦¬ ì‹œê°„ - ëŒ€ëµì ì¸ ì¤€ë¹„ + ì¡°ë¦¬ ì‹œê°„

                            ë‚œì´ë„ - ì‰¬ì›€ / ë³´í†µ / ì–´ë ¤ì›€

                            ì¬ë£Œ ëª©ë¡ - ì¸ë¶„ ê¸°ì¤€, ê³„ëŸ‰ ë‹¨ìœ„ í¬í•¨

                            ì¡°ë¦¬ ë‹¨ê³„ - ë‹¨ê³„ë³„ ë²ˆí˜¸ ë§¤ê¸°ê¸°, êµ¬ì²´ì ì´ê³  ê°„ë‹¨í•œ ì„¤ëª…

                            ìš”ë¦¬ íŒ & ëŒ€ì²´ ì¬ë£Œ - ê³„ì ˆ ì‹ì¬ë£Œë¥¼ ì‚´ë¦¬ê±°ë‚˜ ì‘ìš©í•  ìˆ˜ ìˆëŠ” íŒ

                            few-shot ì˜ˆì‹œ
                            ë ˆì‹œí”¼ ì´ë¦„: ìˆœì²œ ì• í˜¸ë°• ë‹¬ê±€ë³¶ìŒ

                            ì¡°ë¦¬ ì‹œê°„: 15ë¶„
                            
                            ë‚œì´ë„: ì‰¬ì›€
                            
                            ì¬ë£Œ: ì• í˜¸ë°• 1ê°œ, ë‹¬ê±€ 2ê°œ, ì‹ìš©ìœ  1í°ìˆ , ì†Œê¸ˆ ì•½ê°„, í›„ì¶” ì•½ê°„

                            ì¡°ë¦¬ ë‹¨ê³„(ë²ˆí˜¸ ë§¤ê¸°ê¸°, ë‹¨ê³„ë³„ë¡œ ëª…í™•íˆ ì‘ì„±):

                            - ì• í˜¸ë°•ì„ ë°˜ë‹¬ ëª¨ì–‘ìœ¼ë¡œ ì¬ë‹¤.

                            - ë‹¬ê±€ì„ í’€ì–´ ì†Œê¸ˆ ì•½ê°„ì„ ë„£ê³  ì„ëŠ”ë‹¤.

                            - íŒ¬ì— ì‹ìš©ìœ ë¥¼ ë‘ë¥´ê³  ì• í˜¸ë°•ì„ ì¤‘ë¶ˆì—ì„œ 2~3ë¶„ê°„ ë³¶ëŠ”ë‹¤.

                            - ì• í˜¸ë°•ì´ íˆ¬ëª…í•´ì§€ë©´ ë‹¬ê±€ë¬¼ì„ ë¶€ì–´ ë¹ ë¥´ê²Œ ì €ì–´ ìµíŒë‹¤.

                            - í›„ì¶”ë¡œ ê°„í•˜ê³  ë¶ˆì„ ëˆë‹¤.

                            ìš”ë¦¬ íŒ & ëŒ€ì²´ ì¬ë£Œ:

                            ê¸°í˜¸ì— ë”°ë¼ ì°¸ê¸°ë¦„ í•œ ë°©ìš¸ì„ ë„£ìœ¼ë©´ ê³ ì†Œí•œ í’ë¯¸ê°€ ì‚´ì•„ë‚˜ìš”.

                            ë‹¬ê±€ ëŒ€ì‹  ë‘ë¶€ë¥¼ ë„£ì–´ë„ ë‹´ë°±í•˜ê³  ë§›ìˆìŠµë‹ˆë‹¤.

                            ë‹µë³€ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.`;

            await fetchRecipeFromAI(prompt);
        }

        // ë§ì¶¤í˜• ì…ë ¥ì°½ ë³´ì—¬ì£¼ê¸°
        function showCustomInput() {
            customInputArea.classList.toggle('hidden');
        }

        // ë§ì¶¤í˜• ë ˆì‹œí”¼ ì¶”ì²œ ì²˜ë¦¬
        async function handleCustomPrompt() {
            const userIngredients = userIngredientsInput.value.trim();
            const category = ingredientCategorySelect.value;
            const categoryName = ingredientCategorySelect.options[ingredientCategorySelect.selectedIndex].text;
            let special_productsList_agri = data.sclocal_products_agricultural.map(item => item.ìƒí’ˆëª…);
            let special_productsList_fish = data.sclocal_products_fishery.map(item => item.ìƒí’ˆëª…);
            let special_productsList_live = data.sclocal_products_livestock.map(item => item.ìƒí’ˆëª…);  
            let allProductsList = [];
            

            if (!userIngredients) {
                addMessage("ì¬ë£Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "bot");
                return;
            }

            addMessage(`ë‚˜ì˜ ì¬ë£Œ: ${userIngredients}\nì¶”ê°€ ì¬ë£Œ ì¹´í…Œê³ ë¦¬: ${categoryName}`, "user");
            showLoading(true);

            if (category == 'agricultural') {
                allProductsList = special_productsList_agri;
            } else if (category == 'fishery') {
                allProductsList = special_productsList_fish;
            } else if (category == 'livestock') {
                allProductsList = special_productsList_live;
            }   
            
            console.log(allProductsList)
            
            // AIì—ê²Œ ë³´ë‚¼ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
            const prompt = `ë‹¹ì‹ ì€ ìˆœì²œ ë¡œì»¬í‘¸ë“œì™€ ì œì²  ì‹ì¬ë£Œì— ì „ë¬¸ì„±ì„ ê°€ì§„ ì…°í”„ & í‘¸ë“œ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.
                            ì‚¬ìš©ìê°€ ê°€ì§„ ì¬ë£Œ: ${userIngredients}

                            ë‹¤ìŒì€ ìˆœì²œ ë¡œì»¬í‘¸ë“œ ${categoryName}ì˜ ëª¨ë“  ìƒí’ˆ ëª©ë¡ì…ë‹ˆë‹¤:
                            ${allProductsList.join(', ')}

                            ìš”ì²­ ì‚¬í•­

                            ìœ„ ëª©ë¡ì—ì„œ ì‚¬ìš©ìê°€ ê°€ì§„ ì¬ë£Œì™€ ê¶í•©ì´ ê°€ì¥ ì¢‹ì€ ìƒí’ˆ 1ê°€ì§€ë¥¼ ì„ íƒí•˜ê³ , ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”.

                            ì„ íƒí•œ ìƒí’ˆëª…ê³¼ ì´ìœ ë¥¼ ëª…í™•í•˜ê²Œ ì¶œë ¥í•´ì£¼ì„¸ìš”.

                            ê·¸ ìƒí’ˆê³¼ ì‚¬ìš©ìì˜ ì¬ë£Œë¥¼ í™œìš©í•´ ê°„ë‹¨í•˜ê³  ë”°ë¼ í•˜ê¸° ì‰¬ìš´ ê°€ì •ì‹ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

                            ë ˆì‹œí”¼ëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:

                            ì¶œë ¥ í˜•ì‹(ë‹µë³€ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.):

                            ë ˆì‹œí”¼ ì´ë¦„ - ëŒ€ì¤‘ì ì´ë©´ì„œ ì§ê´€ì ì¸ ì´ë¦„

                            ì¶”ì²œ ìˆœì²œ ë¡œì»¬í‘¸ë“œ - ì„ íƒí•œ ìƒí’ˆëª…

                            ì¶”ì²œ ì´ìœ  - ì¶”ì²œ ì´ìœ 

                            ê°„ë‹¨í•œ ìš”ë¦¬ ì„¤ëª… - í•´ë‹¹ ìš”ë¦¬ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…

                            ì¡°ë¦¬ ì‹œê°„ - ëŒ€ëµì ì¸ ì¤€ë¹„ + ì¡°ë¦¬ ì‹œê°„

                            ë‚œì´ë„ - ì‰¬ì›€ / ë³´í†µ / ì–´ë ¤ì›€

                            ì¬ë£Œ ëª©ë¡ - ì¸ë¶„ ê¸°ì¤€, ê³„ëŸ‰ ë‹¨ìœ„ í¬í•¨

                            ì¡°ë¦¬ ë‹¨ê³„ - ë‹¨ê³„ë³„ ë²ˆí˜¸ ë§¤ê¸°ê¸°, êµ¬ì²´ì ì´ê³  ê°„ë‹¨í•œ ì„¤ëª…

                            ìš”ë¦¬ íŒ & ëŒ€ì²´ ì¬ë£Œ - ê³„ì ˆ ì‹ì¬ë£Œë¥¼ ì‚´ë¦¬ê±°ë‚˜ ì‘ìš©í•  ìˆ˜ ìˆëŠ” íŒ

                            ë§ˆì§€ë§‰ì— ìƒí’ˆëª…ì„ ë‹¤ì‹œ í•œ ë²ˆ ê°•ì¡°í•˜ê³ , êµ¬ë§¤ë¥¼ ìœ ë„í•˜ëŠ” ì§§ê³  ì„¤ë“ë ¥ ìˆëŠ” ë¬¸ì¥ì„ ë§ë¶™ì´ì„¸ìš”.

                            few-shot ì˜ˆì‹œ

                            ì¶”ì²œ ìˆœì²œ ë¡œì»¬í‘¸ë“œ: ìˆœì²œ ì• í˜¸ë°•
                            ì¶”ì²œ ì´ìœ : ì‚¬ìš©ìê°€ ê°€ì§„ ë‹¬ê±€, ì–‘íŒŒì™€ í•¨ê»˜ ë³¶ìœ¼ë©´ ë‹¨ë°±ì§ˆê³¼ ì±„ì†Œê°€ ê· í˜• ì¡íŒ ê°„ë‹¨í•œ ë°˜ì°¬ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”!

                            few-shot ì˜ˆì‹œ
                            ë ˆì‹œí”¼ ì´ë¦„: ìˆœì²œ ì• í˜¸ë°• ë‹¬ê±€ë³¶ìŒ

                            ì¡°ë¦¬ ì‹œê°„: 15ë¶„
                            
                            ë‚œì´ë„: ì‰¬ì›€
                            
                            ì¬ë£Œ: ì• í˜¸ë°• 1ê°œ, ë‹¬ê±€ 2ê°œ, ì‹ìš©ìœ  1í°ìˆ , ì†Œê¸ˆ ì•½ê°„, í›„ì¶” ì•½ê°„

                            ì¡°ë¦¬ ë‹¨ê³„(ë²ˆí˜¸ ë§¤ê¸°ê¸°, ë‹¨ê³„ë³„ë¡œ ëª…í™•íˆ ì‘ì„±):

                            - ì• í˜¸ë°•ì„ ë°˜ë‹¬ ëª¨ì–‘ìœ¼ë¡œ ì¬ë‹¤.

                            - ë‹¬ê±€ì„ í’€ì–´ ì†Œê¸ˆ ì•½ê°„ì„ ë„£ê³  ì„ëŠ”ë‹¤.

                            - íŒ¬ì— ì‹ìš©ìœ ë¥¼ ë‘ë¥´ê³  ì• í˜¸ë°•ì„ ì¤‘ë¶ˆì—ì„œ 2~3ë¶„ê°„ ë³¶ëŠ”ë‹¤.

                            - ì• í˜¸ë°•ì´ íˆ¬ëª…í•´ì§€ë©´ ë‹¬ê±€ë¬¼ì„ ë¶€ì–´ ë¹ ë¥´ê²Œ ì €ì–´ ìµíŒë‹¤.

                            - í›„ì¶”ë¡œ ê°„í•˜ê³  ë¶ˆì„ ëˆë‹¤.

                            ìš”ë¦¬ íŒ & ëŒ€ì²´ ì¬ë£Œ:

                            ê¸°í˜¸ì— ë”°ë¼ ì°¸ê¸°ë¦„ í•œ ë°©ìš¸ì„ ë„£ìœ¼ë©´ ê³ ì†Œí•œ í’ë¯¸ê°€ ì‚´ì•„ë‚˜ìš”.

                            ë‹¬ê±€ ëŒ€ì‹  ë‘ë¶€ë¥¼ ë„£ì–´ë„ ë‹´ë°±í•˜ê³  ë§›ìˆìŠµë‹ˆë‹¤.

                            êµ¬ë§¤ ìœ ë„ ë©˜íŠ¸:
                            ìˆœì²œ ì• í˜¸ë°•ì€ ì§€ê¸ˆ ìˆœì²œ ë¡œì»¬í‘¸ë“œ ì§ë§¤ì¥ì—ì„œ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”! ì˜¤ëŠ˜ ë°”ë¡œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•„ ì‹ ì„ í•œ ë§›ì„ ì¦ê²¨ë³´ì„¸ìš”.

                            ë‹µë³€ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
            `;

            await fetchRecipeFromAI(prompt);
        }

        // AIë¡œë¶€í„° ë ˆì‹œí”¼ë¥¼ ë°›ì•„ì˜¤ëŠ” API í˜¸ì¶œ í•¨ìˆ˜ (OpenAI ë²„ì „)
        async function fetchRecipeFromAI(prompt) {
            try {
                const payload = {
                    model: "gpt-4o-mini",
                    messages: [{ role: "user", content: prompt }]
                };
                
                let response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const maxRetries = 3;
                let retries = 0;
                while (!response.ok && retries < maxRetries) {
                    await new Promise(res => setTimeout(res, Math.pow(2, retries) * 1000));
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`
                        },
                        body: JSON.stringify(payload)
                    });
                    retries++;
                }
                
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                
                const result = await response.json();
                const recipeText = result.choices?.[0]?.message?.content;
                
                if (recipeText) {
                    addMessage(recipeText, 'bot');
                } else {
                    addMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ë ˆì‹œí”¼ë¥¼ ìƒì„±í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", 'bot');
                }

                if (recipeText) {
                    addMessage('ë ˆì‹œí”¼ì— ì´ìš©ëœ ì¬ë£ŒëŠ” ìˆœì²œ ë¡œì»¬í‘¸ë“œ ì§ë§¤ì¥ì—ì„œ ë§Œë‚˜ë³´ì‹¤ ìˆ˜ ìˆì–´ìš”! êµ¬ë§¤í•´ ë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”?<br><a href="https://sclocal.kr/" target="_blank" class="text-blue-500 underline">ìˆœì²œ ë¡œì»¬í‘¸ë“œ ë°”ë¡œê°€ê¸°</a>', 'bot');
                }


            } catch (error) {
                console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                addMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", 'bot');
            } finally {
                showLoading(false);
            }
        }

        // ì›¹í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = loadData;
    </script>

</body>
</html>
